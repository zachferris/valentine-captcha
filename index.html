<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Security Check</title>
  <style>
    :root{
      --bg:#0b1220; --card:#111a2d; --card2:#0f172a;
      --text:#e6eefc; --muted:#9bb0d0; --accent:#7c3aed; --ok:#22c55e; --bad:#ef4444;
      --shadow: 0 20px 60px rgba(0,0,0,.35);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh; display:grid; place-items:center;
      background: radial-gradient(1200px 800px at 20% 10%, rgba(124,58,237,.35), transparent 60%),
                  radial-gradient(900px 600px at 90% 40%, rgba(34,197,94,.18), transparent 60%),
                  var(--bg);
      color:var(--text); font: 15px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial;
      padding:24px;
    }
    .wrap{width:min(860px, 100%);}
    .brand{
      display:flex; align-items:center; gap:10px;
      color:var(--muted); letter-spacing:.12em; text-transform:uppercase; font-size:12px;
      margin: 0 0 14px 4px;
    }
    .dot{width:10px;height:10px;border-radius:50%;background:var(--accent); box-shadow:0 0 20px rgba(124,58,237,.8)}
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      overflow:hidden;
    }
    .top{
      padding:22px 22px 14px;
      background: linear-gradient(180deg, rgba(255,255,255,.05), transparent);
      display:flex; justify-content:space-between; gap:16px; align-items:flex-start;
    }
    h1{margin:0; font-size:18px; font-weight:700}
    .sub{margin:6px 0 0; color:var(--muted); font-size:13px}
    .pill{
      padding:8px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(15,23,42,.55);
      color:var(--muted);
      font-size:12px;
      white-space:nowrap;
    }
    .gridWrap{padding: 16px 22px 22px;}
    .prompt{
      margin:0 0 12px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      color:var(--muted); font-size:13px;
    }
    .prompt b{color:var(--text)}
    .grid{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap:10px;
    }
    .tile{
      position:relative; aspect-ratio: 1/1;
      border-radius:16px; overflow:hidden;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(17,26,45,.6);
      cursor:pointer;
      transform: translateZ(0);
      transition: transform .12s ease, border-color .12s ease, box-shadow .12s ease;
      user-select:none;
    }
    .tile:hover{transform: scale(1.01); border-color: rgba(124,58,237,.35);}
    .tile img{width:100%; height:100%; object-fit:cover; display:block; filter:saturate(1.05) contrast(1.02);}
    .check{
      position:absolute; inset:auto 10px 10px auto;
      width:28px; height:28px; border-radius:999px;
      display:grid; place-items:center;
      background: rgba(12, 20, 36, .75);
      border:1px solid rgba(255,255,255,.14);
      backdrop-filter: blur(10px);
      opacity:0; transform: scale(.9);
      transition: opacity .12s ease, transform .12s ease;
    }
    .tile.selected{
      border-color: rgba(124,58,237,.75);
      box-shadow: 0 0 0 3px rgba(124,58,237,.25);
    }
    .tile.selected .check{opacity:1; transform: scale(1);}
    .check svg{width:18px;height:18px; fill:none; stroke: #c7b8ff; stroke-width:2.4}
    .actions{
      display:flex; gap:10px; align-items:center; justify-content:space-between;
      margin-top:14px;
    }
    button{
      appearance:none; border:none; cursor:pointer;
      padding:12px 14px; border-radius:14px;
      font-weight:700; letter-spacing:.01em;
      background: linear-gradient(180deg, rgba(124,58,237,1), rgba(99,102,241,1));
      color:white;
      box-shadow: 0 10px 30px rgba(124,58,237,.35);
      transition: transform .08s ease, filter .12s ease;
      min-width: 160px;
    }
    button:hover{filter:brightness(1.05)}
    button:active{transform: translateY(1px)}
    .linkish{
      color: var(--muted);
      font-size: 13px;
    }
    .linkish a{color:#b9a7ff; text-decoration:none}
    .status{
      margin-top:10px;
      font-size:13px;
      color: var(--muted);
      min-height: 18px;
    }
    .status.ok{color: var(--ok)}
    .status.bad{color: var(--bad)}
    .shake{ animation: shake .32s ease-in-out; }
    @keyframes shake{
      0%,100%{transform:translateX(0)}
      25%{transform:translateX(-10px)}
      50%{transform:translateX(10px)}
      75%{transform:translateX(-6px)}
    }
    .small{font-size:12px; color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="brand"><span class="dot"></span> verification services</div>

    <div class="card" id="card">
      <div class="top">
        <div>
          <h1>Please verify you’re human</h1>
          <p class="sub">Complete the image challenge to continue.</p>
        </div>
        <div class="pill">Secure Session • Lobby Network</div>
      </div>

      <div class="gridWrap">
        <div class="prompt">
          <span>Challenge: <b>Select all images that are “him”</b></span>
          <span class="small" id="count">0 selected</span>
        </div>

        <div class="grid" id="grid"></div>

        <div class="actions">
          <button id="verifyBtn">Verify</button>
          <div class="linkish">Having trouble? <a href="#" id="reset">Try a new challenge</a></div>
        </div>

        <div class="status" id="status"></div>
      </div>
    </div>
  </div>

  <!-- Music (starts after any click/verify due to autoplay rules) -->
  <audio id="song" src="audio/song.mp3" preload="auto"></audio>

  <script>
    // ✅ EDIT THIS:
    // Put the numbers (1-9) that are pictures OF YOU.
    // Example: if img/2.jpg, img/5.jpg, img/7.jpg are you:
    const ME_SET = new Set([2,5,7]);

    // ✅ OPTIONAL: change her name here (also in valentine.html)
    const HER_NAME = "Babe";

    const grid = document.getElementById("grid");
    const countEl = document.getElementById("count");
    const statusEl = document.getElementById("status");
    const card = document.getElementById("card");
    const song = document.getElementById("song");

    let startedAudio = false;
    const TOTAL = 6;
    let selected = new Set();
    let order = [];

    function startAudioOnce(){
      if (startedAudio) return;
      startedAudio = true;
      // Try to play; if blocked, it'll start on next interaction.
      song.volume = 0.55;
      song.play().catch(()=>{});
    }

    function shuffle(arr){
      for (let i = arr.length - 1; i > 0; i--){
        const j = Math.floor(Math.random() * (i+1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function render(){
      grid.innerHTML = "";
      statusEl.textContent = "";
      statusEl.className = "status";
      selected.clear();

      order.forEach(n => {
        const tile = document.createElement("div");
        tile.className = "tile";
        tile.dataset.n = n;

        const img = document.createElement("img");
        img.src = `img/${n}.jpg`;
        img.alt = "challenge image";

        const check = document.createElement("div");
        check.className = "check";
        check.innerHTML = `
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M20 6L9 17l-5-5"></path>
          </svg>
        `;

        tile.appendChild(img);
        tile.appendChild(check);

        tile.addEventListener("click", () => {
          startAudioOnce();
          const num = Number(tile.dataset.n);
          if (selected.has(num)) {
            selected.delete(num);
            tile.classList.remove("selected");
          } else {
            selected.add(num);
            tile.classList.add("selected");
          }
          countEl.textContent = `${selected.size} selected`;
        });

        grid.appendChild(tile);
      });

      countEl.textContent = `0 selected`;
    }

    function newChallenge(){
      order = shuffle(Array.from({length: TOTAL}, (_, i) => i+1));
      render();
    }

    function sameSet(aSet, bSet){
      if (aSet.size !== bSet.size) return false;
      for (const v of aSet) if (!bSet.has(v)) return false;
      return true;
    }

    document.getElementById("verifyBtn").addEventListener("click", () => {
      startAudioOnce();

      if (ME_SET.size === 0){
        statusEl.textContent = "⚠️ Setup needed: set ME_SET in the code first.";
        statusEl.className = "status bad";
        return;
      }

      if (sameSet(selected, ME_SET)) {
        statusEl.textContent = `✅ Verified. Redirecting for ${HER_NAME}…`;
        statusEl.className = "status ok";
        setTimeout(() => {
          // Pass a tiny token so valentine page can start music too (optional)
          window.location.href = "valentine.html";
        }, 900);
      } else {
        statusEl.textContent = "❌ Hmm… try again (select ONLY him).";
        statusEl.className = "status bad";
        card.classList.remove("shake");
        void card.offsetWidth;
        card.classList.add("shake");
      }
    });

    document.getElementById("reset").addEventListener("click", (e) => {
      e.preventDefault();
      startAudioOnce();
      newChallenge();
    });

    // Start
    newChallenge();
  </script>
</body>
</html>

